# 택시 서비스

## 택시 서비스 소개
* 택시 서비스는 택시정보를 관리하는 서비스입니다.
* TAXI 권한을 가진 회원만 접근 가능합니다.

## 상세 요구사항
* jwt 토큰을 파싱해서 auth가 TAXI인 유저만 택시 서비스에 접근 가능하다.
* 택시의 지역분류는 아래의 지역분류 정책을 따른다.
* 택시 등급은 아래의 택시 등급표를 따르며, 택시 등급은 택시기사의 차량이 변경되면 택시기사의 요청아래 변경이 가능하다.
* 택시기사의 경우 전화번호를 기입한다. 배차후에도 비정상적으로 고객에서 도착하지 않을때 전화해야하기 때문이다.
* 회원이 탈퇴할때 권한이 TAXI라면 택시 정보도 같이 삭제된다.
* 서비스내 택시 식별 번호는 id(pk)이다.
* 전화번호나 차량 번호를 변경하려면 택시 정보를 삭제하고 다시 만들어야한다. 
* 이는 잘 변경되지 않는 특징을 가진 두 컬럼에 대해 unique 제약을 걸어놓았기 때문이다. (unique는 업데이트 불가하다)
* 이에 대한 해결책은 [중복된 값을 가져서는 안되는 Unique 컬럼의 업데이트](https://github.com/liveforone/intelligent_taxi/blob/master/Documents/UNIQUE_COLUMN_UPDATE_PROBLEM.md)에서 볼 수 있다.

## API 설계
### 내부 API
### 외부 API

## Json body 예시

## 서비스간 통신
### 회원 탈퇴시 택시 회원의 택시 정보 삭제
* kafka를 사용한다.
* user-service 가 produce 한다.
```
remove-taxi-belong-member
```

## 지역분류 정책 - 표준 지역분류
* 지역은 특별시·광역시(종래 직할시)·도별로 분류한다.
* 프론트에서 백으로 요청시에도 동일은 분류를 따른다.
* 해당 분류는 서비스내 표준 분류이다.
* 분류는 다음과 같다.
* 아래의 어떠한 값도 입력이 없을시 에러발생한다.
```
[문자] - 프론트 입력 가능 값
서울 경기 인천
강원 
충북 충남 대전
경북 경남 대구 울산 부산
전북 전남 광주
제주

[코드] - 백엔드 
//==수도권==//
SEOUL, GYEONGGI, INCHEON,
//==강원==//
GANGWON,
//==충청==//
CHUNGBUK, CHUNGNAM, DAEJEON,
//==경상==//
GYEONGBUK, GYEONGNAM, DAEGU, ULSAN, BUSAN,
//==전라==//
JEOLLABUK, JEOLLANAM, GWANGJU,
//==제주==//
JEJU;
```

## 택시 등급 표
* 택시 등급은 택시의 종류에 따라 분류한다.
* NORMAL, PREMIUM, VAN 로 분류하며
* NORMAL은 일반 택시
* PREMIUM은 고급 택시
* VAN은 승합 택시를 의미한다.
* 아래의 어떠한 값도 입력이 없을시 에러발생한다.
```
NORMAL, PREMIUM, VAN
```

배차시에 지역은 이미 좌표로 나타내어서 필요가 없지만
택시 등급은 필요하다.
애초에 배차시에 택시 등급별로 배차잡는것을 다르게 할당할것이기에.
배차 정보에 택시 등급을 넣는것도 방법이다.

배차시에 지역을 사용할것 같음.
지역번호를 매기는 것도 방법이지만, 일단은 string으로 쓰자.

[enum response 주의점]
enum자체를 문자열로 response하는 경우에는 문제없지만,
enum의 내부 값으로 response를 할때에는 
mapper에서 getValue()해서 값을 빼서 전달해야한다.
이넘을 문자열로 변환할땐 .name()을
그 안의 값을 뺄때에는 적절한 변수와 게터를 두고 .getValue()로

전화번호/차량번호(번호판) 변경 요청시
삭제 -> 생성
이 과정가운데에서 dto에 엔티티 정보를 swap해놓는 등의 비즈니스 로직 필요


## 할일
전화번호/번호판 변경을 위한 api만들기
쿼리는 주로 username으로 조회유도
쿼리 다만들고 커맨드 서비스 테스트 작성

## 테스트
유저탈퇴시 택시삭제 카프카 테스트